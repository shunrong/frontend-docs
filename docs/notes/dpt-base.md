---
nav:
  title: 笔记
  path: /notes
group:
  title: 中枢-工程化
  order: 2
type:
  title: 设计模式
  order: 5
title: 设计模式介绍
order: 1
---

# 设计模式介绍

这一节课，我们来对设计模式进行一个简单的介绍。

- 基本介绍
- 为什么要取名
- 模式的分类
- 不同语言中的模式
- 设计模式适用性
- 模式的发展



## 基本介绍

首先说一下“模式”这个词，这个词实际上来源于建筑学，由模式之父 *Christopher Alexander*（克里斯托弗·亚历山大）提出。

<img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2021-08-03-080008.png" alt="image-20210803160008527" style="zoom:50%;" />

克里斯托弗·亚历山大在它的著作《建筑模式语言》中首次提出了“模式”的概念。本书介绍了城市设计的“语言”，而该语言的基本单元就

是模式。它们可以描述窗户应该在多高、一座建筑应该有多少层以及一片街区应该有多大面积的植被等等。

1991-1992 年，以“ 四人组 Gang of Four，简称 GoF ”自称：

- Erich Gamma
- Richard Helm
- Ralph Johnson 
- John Vlissides

这四位著名软件工程学者，将模式的思想引入软件工程方法学，并且一起出版了《设计模式：可复用面向对象软件的基础》一书，在书中共提供了 23 种模式来解决面向对象程序设计中的各种问题。

因此，这里我们可以给设计模式一个明确的定义：**<u>设计模式就是在面向对象软件设计过程中针对特定问题的简洁而优雅的解决方案</u>**。

通俗一点来讲，设计模式是在某个场合下针对某个问题的一种解决方案。如果再通俗一点来说，设计模式就是给面向对象软件开发中的一些好的设计取个名字。



## 为什么要取名

那么，给模式取名字的意义是什么呢？

GoF 成员之一 John Vlissides 在他的另一本关于设计模式的著作《设计模式沉思录》中写过这样一段话：

>设想一个电子爱好者，虽然他没有经过正规的培训，但是却日积月累地设计并制造出了许多有用的电子设备：业余无线电、盖革计数器、报警器等。
>
>有一天这个爱好者决定重新回到学校去攻读电子学学位，来让自己的才能得到真实的认可。随着课程的展开，这个爱好者突然发现这些课程内容都似曾相似。似曾相似的不是术语或者表达的方式，而是背后的概念。
>
>这个爱好者不断学到一些名称和原理，虽然这些名称和原理他以前不知道，但事实上他多年来一直都在使用。这个过程只不过是一个接一个的顿悟。

软件开发中的设计也是如此。**<u>这些“好的设计”并不是 *GoF* 发明的</u>**，而是早已经存在于软件开发中。一个稍有经验的程序员也许在不知不觉中数次使用过这些设计模式。

*GoF* 最大的功绩是把这些好的设计从浩瀚的面向对象世界中挑选出来，并且**<u>给予它们一个好听又好记的名字</u>**。在软件设计中，一个好的设计方案<u>有了名字之后，才能被更好地传播</u>，人们才有更多的机会去<u>分享和学习它们</u>。

>假设你是一名足球教练，正在球场边指挥一场足球赛。通过一段时间的观察后，你发现对方的后卫技术精湛，身体强壮，但边后卫速度较慢，中后卫身高和头球都一般。于是你在场边大声指挥球员：用速度突破对方边后卫之后，往球门方向踢出高球，中路接应队员抢点头球攻门。
>
><img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2024-03-21-021827.jpg" alt="16290180978629" style="zoom:33%;" />
>
>在机会稍纵即逝的足球场上，教练这样费尽口舌地指挥队员比赛无疑是荒谬的。实际上这种战术有一个名字叫做“下底传中”。
>
>正因为战术有了对应的名字，在球场上教练可以很方便地和球员交流。“下底传中”这种战术即是足球场上的一种“模式”。

在软件设计中也是如此。我们都知道设计经验非常重要。也许我们都有过这种感觉：这个问题发生的场景似曾相似，以前我遇到并解决过这个问题，但是我不知道怎么跟别人去描述它。

我们非常希望给这个问题出现的场景和解决方案取一个统一的名字，当别人听到这个名字的时候，便知道我想表达什么。例如，在和团队成员进行沟通的时候，你只需要说“哦，这里用单例模式就可以了”，所有人都会理解这条建议背后的想法。只要知晓模式及其名称，你就无需解释什么是单例。



## 模式的分类

在这 23 种模式中，可以根据意图或者目的来进行分类：

- 创建型模式：提供一种**<u>创建对象的机制</u>**，增加已有代码的灵活性和复用性
- 结构型模式：介绍如何**<u>将对象和类组装成较大的结构</u>**，并同时保持结构的灵活和高效
- 行为型模式：负责**<u>对象间的高效沟通和职责分配</u>**。

<img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2024-03-21-021116.jpg" alt="16290170569774" style="zoom:40%;" />

整个 23 种模式一览表如下：

<img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/16123458849704.jpg" alt="image-20210803160250301" style="zoom:90%;" />



## 不同语言中的模式

《设计模式》一书的副标题是“可复用面向对象软件的基础”。

《设计模式》这本书完全是从基于类的面向对象设计的角度出发的，通过对封装、继承、多态、组合等技术的反复使用，提炼出一些可重复使用的面向对象设计技巧。

所以有一种说法是设计模式仅仅是就基于类的面向对象的语言而言的。

<img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2024-03-21-020551.jpg" alt="16290188190812" style="zoom:50%;" />

《设计模式》最初讲的确实是静态类型语言中的设计模式，原书大部分代码由 C++ 写成，但**<u>设计模式实际上是解决某些问题的一种思想，与具体使用的语言无关。</u>**

模式社区和语言一直都在发展，如今，除了主流的面向对象语言，函数式语言的发展也非常迅猛。在函数式或者其他编程范型的语言中，**<u>设计模式依然存在，只是一个多或者少的区别</u>**。

人类飞上天空需要借助飞机等工具，而鸟儿天生就有翅膀。

<img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2024-03-21-020658.jpg" alt="16290189442690" style="zoom:35%;" />

在 Dota 游戏里，牛头人的人生目标是买一把跳刀（跳刀可以使用跳跃技能），而敌法师天生就有跳跃技能。

<img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2024-03-21-020723.jpg" alt="16290190883856" style="zoom:40%;" />

因为语言的不同，一些设计模式在另外一些语言中的实现也许跟我们在《设计模式》一书中看到的大相径庭，这一点也不令人意外。

Google 的研究总监 Peter Norvig 早在 1996 年一篇名为“动态语言设计模式”的演讲中，就指出 了 GoF 所提出的 23 种设计模式，其中有 *16* 种在 *Lisp* 语言中已经是天然的实现。

示例一：

比如，Command 模式在 Java 中需要一个命令类，一个接收者类，一个调用者类。Command 模式把运算块封装在命令对象的方法内，成为该对象的行为，并把命令对象四处传递。

但在 Lisp 或者 JavaScript 这些把函数当作一等对象的语言中，函数便能封装运算块，并且函数可以被当成对象一样四处传递，这样一来，命令模式在 Lisp 或者 JavaScript 中就成为了一种隐形的模式。

示例二：

在 Java 这种静态编译型语言中，无法动态地给已存在的对象添加新的职责，所以一般通过包装类的方式来实现装饰者模式。

但在 JavaScript 这种动态解释型语言中，给对象动态添加职责是再简单不过的事情。这就造成了 JavaScript 语言的装饰者模式不再关注于给对象动态添加职责，而是关注于给函数动态添加职责。



## 设计模式适用性

设计模式被一些人认为只是夸夸其谈的东西，这些人认为设计模式并没有多大用途。

毕竟我们用普通的方法就能解决的问题，使用设计模式可能会增加复杂度，或带来一些额外的代码。如果对一些设计模式使用不当，事情可能还变得更糟。

从某些角度来看，设计模式确实有可能带来代码量的增加，或许也会把系统的逻辑搞得更复杂。<u>但软件开发的成本并非全部在开发阶段，设计模式的作用是让人们写出**可复用**和**可维护性高**的程序。</u>

>假设有一个空房间，我们要日复一日地往里面放一些东西。
>
>最简单的办法当然是把这些东西直接扔进去，但是时间久了，就会发现很难从这个房子里找到自己想要的东西，要调整东西的位置也不容易。
>
><img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2024-03-21-023029.jpg" alt="16290196981254" style="zoom:30%;" />
>
>所以在房间里做一些柜子也许是个更好的选择，虽然柜子会增加我们的成本，但它可以在维护阶段为我们带来好处。使用这些柜子存放东西的规则，或许就是一种模式。
>
><img src="https://xiejie-typora.oss-cn-chengdu.aliyuncs.com/2024-03-21-023129.jpg" alt="16290197638442" style="zoom: 30%;" />
>
>

所有设计模式的实现都遵循一条原则，即“找出程序中变化的地方，并将变化封装起来”。

一个程序的设计总是可以分为可变的部分和不变的部分。当我们找出可变的部分，并且把这些部分封装起来，那么剩下的就是不变和稳定的部分。这些不变和稳定的部分是非常容易复用的。这也是设计模式为什么描写的是可复用面向对象软件基础的原因。

设计模式被人误解的一个重要原因是人们对它的误用和滥用，比如将一些模式用在了错误的场景中，或者说在不该使用模式的地方刻意使用模式。特别是初学者在刚学会使用一个模式时，恨不得把所有的代码都用这个模式来实现。锤子理论在这里体现得很明显：当我们有了一把锤子，看什么都是钉子。

拿足球比赛的例子来说，我们的目标只是进球，“下底传中”这种“模式”仅仅是达到进球目标的一种手段。

当我们面临密集防守时，下底传中或许是一种好的选择。但如果我们的球员获得了一个直接面对对方守门员的单刀机会，那么是否还要把球先传向边路队友，再由边路队友来一个边路传中呢？

答案是显而易见的，模式应该用在正确的地方。而哪些才算正确的地方，只有在我们深刻理解了模式的意图之后，再结合项目的实际场景才会知道。



## 模式的发展

模式的社区一直在发展。

GoF 在 1995 年提出了 23 种设计模式。但模式不仅仅局限于这 23 种。在近 30 年的时间里，也许有更多的模式已经被人发现并总结了出来。

比如一些 JavaScript 图书中会提到模块模式、沙箱模式等。这些“模式”能否被世人公认并流传下来，还有待时间验证。不过某种解决方案要成为一种模式，还是有几个原则要遵守的。

这几个原则即是“是否能够再现”、“是否能够教学”和“是否能够以一个名字来描述这种模式”。

不管怎样，在一些模式被公认并流行起来之前，需要慎重地冠之以某种模式的名称。否则模式也许很容易泛滥，导致人人都在发明模式，这反而增加了交流的难度。说不准哪天我们就能听到有人说全局变量模式、加模式、减模式等。

在《设计模式》出版后的近 30 年里，数不清的程序员从设计模式中获益，也许是改善了自己编写的某个软件，也许是从设计模式的学习中更好地理解了面向对象编程思想。

无论如何，相信对我们这些大多数的普通程序员来说，系统地学习设计模式并没有坏处，相反，你会在模式的学习过程中受益匪浅。

---

-EOF-